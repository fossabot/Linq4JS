var Linq4JS;!function(Linq4JS){var Entity=function(){function Entity(_id){this.Id=_id}return Entity}();Linq4JS.Entity=Entity}(Linq4JS||(Linq4JS={}));var Linq4JS;!function(Linq4JS){var Helper=function(){function Helper(){}return Helper}();Helper.ConvertStringFunction=function(functionString){if(0==functionString.length)throw"Linq4JS: Cannot convert empty string to function";var varname=functionString.substring(0,functionString.indexOf("=>")).replace(" ","");if(varname.indexOf(",")!=-1)throw"Linq4JS: Cannot use '"+varname+"' as variable";var func=functionString.substring(functionString.indexOf("=>")+2).split(".match(//gi)").join("");return func="return "+func,Function(varname,func)},Helper.ConvertFunction=function(testFunction){var result;if("function"==typeof testFunction)result=testFunction;else{if("string"!=typeof testFunction)throw"Linq4JS: Cannot use '"+testFunction+"' as function";result=Linq4JS.Helper.ConvertStringFunction(testFunction)}return result},Helper.OrderCompareFunction=function(valueSelector,a,b,invert){var value_a=valueSelector(a),value_b=valueSelector(b),type=typeof value_a;if("string"==type){var value_a_string=value_a;value_a_string=value_a_string.toLowerCase();var value_b_string=value_b;return value_b_string=value_b_string.toLowerCase(),value_a_string>value_b_string?1==invert?-1:1:value_a_string<value_b_string?1==invert?1:-1:0}if("number"==type){var value_a_number=value_a,value_b_number=value_b;return 1==invert?value_b_number-value_a_number:value_a_number-value_b_number}if("boolean"==type){var value_a_bool=value_a,value_b_bool=value_b;return value_a_bool==value_b_bool?0:1==invert?value_a_bool?1:-1:value_a_bool?-1:1}throw"Linq4JS: Cannot map type '"+type+"' for compare\""},Linq4JS.Helper=Helper}(Linq4JS||(Linq4JS={}));var Linq4JS;!function(Linq4JS){var OrderEntry=function(){function OrderEntry(_direction,_valueSelector){this.Direction=_direction,this.ValueSelector=_valueSelector}return OrderEntry}();Linq4JS.OrderEntry=OrderEntry;var OrderDirection;!function(OrderDirection){OrderDirection[OrderDirection.Ascending=0]="Ascending",OrderDirection[OrderDirection.Descending=1]="Descending"}(OrderDirection=Linq4JS.OrderDirection||(Linq4JS.OrderDirection={}))}(Linq4JS||(Linq4JS={})),Array.prototype.Add=function(object,generateId){var that=this;if(null!=object){if(1==generateId){var newIndex_1,last=that.LastOrDefault();if(null!=last){for(newIndex_1=null!=last._Id?last._Id:1;that.Any(function(x){return x._Id==newIndex_1});)newIndex_1++;object._Id=newIndex_1}else object._Id=1}that.push(object)}return that},Array.prototype.AddRange=function(objects){var that=this;return objects.ForEach(function(x){that.Add(x)}),that},Array.prototype.Any=function(filter){var that=this;return that.Count(filter)>0},Array.prototype.Clone=function(){for(var that=this,newArray=new Array,_i=0,that_1=that;_i<that_1.length;_i++){var obj=that_1[_i];newArray.Add(obj)}return newArray},Array.prototype.Count=function(filter){var that=this;return null!=filter?that.Where(filter).length:that.length},Array.prototype.Distinct=function(valueSelector,takelast){for(var prev,that=this,valueSelectorFunction=Linq4JS.Helper.ConvertFunction(valueSelector),temp=that.OrderBy(valueSelectorFunction),newArray=new Array,i=0;i<temp.length;i++){var current=temp[i];if(1==takelast){var next=temp[i+1];null!=next?valueSelectorFunction(current)!=valueSelectorFunction(next)&&newArray.Add(current):newArray.Add(current)}else{if(null!=prev&&valueSelectorFunction(current)==valueSelectorFunction(prev))continue;newArray.Add(current),prev=current}}return newArray},Array.prototype.FindIndex=function(filter){var that=this;if(null!=filter){for(var i=(Linq4JS.Helper.ConvertFunction(filter),0);i<that.length;i++){var obj=that[i];if(1==filter(obj))return i}return-1}throw"Linq4JS: You must define a filter"},Array.prototype.First=function(filter){var that=this;if(null!=filter){var result=that.Where(filter);if(result.Any())return result.Get(0);throw"Linq4JS: The First Entry was not found"}if(that.Any())return that.Get(0);throw"Linq4JS: The First Entry was not found"},Array.prototype.FirstOrDefault=function(filter){var that=this;if(null!=filter){var result=that.Where(filter);return result.Any()?result.Get(0):null}return that.Any()?that.Get(0):null},Array.prototype.ForEach=function(action){for(var that=this,actionFunction=Linq4JS.Helper.ConvertFunction(action),_i=0,that_2=that;_i<that_2.length;_i++){var obj=that_2[_i];actionFunction(obj)}return that},Array.prototype.Get=function(index){var that=this;return that[index]},Array.prototype.Insert=function(object,index){var that=this;return that.splice(index,0,object),that},Array.prototype.Last=function(filter){var that=this;if(null!=filter){var result=that.Where(filter);if(result.Any())return result.Get(result.length-1);throw"Linq4JS: The Last Entry was not found"}if(that.Any())return that.Get(that.length-1);throw"Linq4JS: The Last Entry was not found"},Array.prototype.LastOrDefault=function(filter){var that=this;if(null!=filter){var result=that.Where(filter);return result.Any()?result.Get(result.length-1):null}return that.Any()?that.Get(that.length-1):null},Array.prototype.Move=function(oldIndex,newIndex){var that=this;return that.splice(newIndex,0,that.splice(oldIndex,1)[0]),that},Array.prototype.OrderBy=function(valueSelector){var that=this,valueSelectorFunction=Linq4JS.Helper.ConvertFunction(valueSelector),ordered=that.Clone();return ordered.Order=new Array(new Linq4JS.OrderEntry(Linq4JS.OrderDirection.Ascending,valueSelectorFunction)),ordered.sort(function(a,b){return Linq4JS.Helper.OrderCompareFunction(valueSelectorFunction,a,b,!1)})},Array.prototype.OrderByDescending=function(valueSelector){var that=this,valueSelectorFunction=Linq4JS.Helper.ConvertFunction(valueSelector),ordered=that.Clone();return ordered.Order=new Array(new Linq4JS.OrderEntry(Linq4JS.OrderDirection.Descending,valueSelectorFunction)),ordered.sort(function(a,b){return Linq4JS.Helper.OrderCompareFunction(valueSelectorFunction,a,b,!0)})},Array.prototype.Range=function(start,length){for(var that=this,newArray=new Array,i=start;i<start+length;i++)newArray.Add(that.Get(i));return newArray},Array.prototype.Remove=function(object,primaryKeySelector){var targetIndex,that=this;if(null==object)throw"Linq4JS: The object cannot be null";if(null!=primaryKeySelector){var selector_1=Linq4JS.Helper.ConvertFunction(primaryKeySelector);targetIndex=that.FindIndex(function(x){return selector_1(x)==selector_1(object)})}else targetIndex=null!=object.Id?that.FindIndex(function(x){return x.Id==object.Id}):that.FindIndex(function(x){return x==object});if(targetIndex==-1)throw"Linq4JS: Nothing found to Remove";return that.splice(targetIndex,1),that},Array.prototype.RemoveRange=function(objects,primaryKeySelector){var that=this;if(null!=primaryKeySelector){var selector_2=Linq4JS.Helper.ConvertFunction(primaryKeySelector);objects.ForEach(function(x){that.Remove(x,selector_2)})}else objects.ForEach(function(x){that.Remove(x)});return that},Array.prototype.Select=function(selector){for(var that=this,selectorFunction=Linq4JS.Helper.ConvertFunction(selector),newArray=new Array,_i=0,that_3=that;_i<that_3.length;_i++){var obj=that_3[_i];newArray.Add(selectorFunction(obj))}return newArray},Array.prototype.Skip=function(count){var that=this;return that.slice(count,that.Count())},Array.prototype.Take=function(count){var that=this;return that.slice(0,count)},Array.prototype.ThenBy=function(valueSelector){var that=this,valueSelectorFunction=Linq4JS.Helper.ConvertFunction(valueSelector);if(null==that.Order||0==that.Order.Count())throw"Linq4JS: Please call OrderBy or OrderByDescending before ThenBy";var ordered=that;return ordered.Order.Add(new Linq4JS.OrderEntry(Linq4JS.OrderDirection.Ascending,valueSelectorFunction)),ordered.sort(function(a,b){for(var _i=0,_a=ordered.Order;_i<_a.length;_i++){var entry=_a[_i],result=Linq4JS.Helper.OrderCompareFunction(entry.ValueSelector,a,b,entry.Direction==Linq4JS.OrderDirection.Descending);if(0!=result)return result}return 0})},Array.prototype.ThenByDescending=function(valueSelector){var that=this,valueSelectorFunction=Linq4JS.Helper.ConvertFunction(valueSelector);if(null==that.Order||0==that.Order.Count())throw"Linq4JS: Please call OrderBy or OrderByDescending before ThenByDescending";var ordered=that;return ordered.Order.Add(new Linq4JS.OrderEntry(Linq4JS.OrderDirection.Descending,valueSelectorFunction)),ordered.sort(function(a,b){for(var _i=0,_a=ordered.Order;_i<_a.length;_i++){var entry=_a[_i],result=Linq4JS.Helper.OrderCompareFunction(entry.ValueSelector,a,b,entry.Direction==Linq4JS.OrderDirection.Descending);if(0!=result)return result}return 0})},Array.prototype.Update=function(object,primaryKeySelector){var targetIndex,that=this;if(null==object)throw"Linq4JS: The object cannot be null";if(null!=primaryKeySelector){var selector_3=Linq4JS.Helper.ConvertFunction(primaryKeySelector);targetIndex=that.FindIndex(function(x){return selector_3(x)==selector_3(object)})}else targetIndex=null!=object.Id?that.FindIndex(function(x){return x.Id==object.Id}):that.FindIndex(function(x){return x==object});if(targetIndex==-1)throw"Linq4JS: Nothing found to Update";for(var keys=Object.keys(object),_i=0,keys_1=keys;_i<keys_1.length;_i++){var key=keys_1[_i];"Id"!=key&&(that[targetIndex][key]=object[key])}return that},Array.prototype.UpdateRange=function(objects,primaryKeySelector){var that=this;if(null!=primaryKeySelector){var selector_4=Linq4JS.Helper.ConvertFunction(primaryKeySelector);objects.ForEach(function(x){that.Update(x,selector_4)})}else objects.ForEach(function(x){that.Update(x)});return that},Array.prototype.Where=function(filter){var that=this;if(null!=filter){for(var filterFunction=Linq4JS.Helper.ConvertFunction(filter),newArray=new Array,i=0;i<that.length;i++){var obj=that[i];1==filterFunction(obj)&&newArray.push(obj)}return newArray}throw"Linq4JS: You must define a filter"};